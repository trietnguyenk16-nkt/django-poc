pipeline {
    agent any
    stages {
        stage("Source Code Management")  {
          steps {
              git branch: 'main', url: 'https://github.com/trietnguyenk16-nkt/django-poc.git' 
          }
        }
        stage("Installed libraries") {
            steps { 
		    sh "which python"
		    sh "which python3.8"
		    sh "which python3"
		    sh "python3.8 -m venv jenkinsenv"
		    script {
			    if (fileExists('requirements.txt')) {
	    			sh """
	    				source jenkinsenv/bin/activate
	    				pip3.8 install -r requirements.txt
	    				source jenkinsenv/bin/activate
	    				python3.8 manage.py makemigrations
	       				python3.8 manage.py migrate
		   			
	    			"""
			    } else {
				    echo "requirements.txt is not exist"
			    }
		    }
            }
        }
	stage("Run unit test") {
	   steps {
		sh """
    			source jenkinsenv/bin/activate
    			python manage.py test tests
    		"""
	}
	}
    }
}

